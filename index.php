<!DOCTYPE html>
<html>

<head>
  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no" />
  <link rel="shortcut icon" href="images/lingotsdor.png" type="image/x-icon">
  <title>
    Auchan - Commande de Lingots d'Or
  </title>
  <link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/OwlCarousel2/2.3.4/assets/owl.carousel.min.css" />
  <link rel="stylesheet" type="text/css" href="css/bootstrap.css" />
  <link href="css/style.css" rel="stylesheet" />
  <link href="css/responsive.css" rel="stylesheet" />
</head>

<body>
  <div class="hero_area">
    <header class="header_section">
      <nav class="navbar navbar-expand-lg custom_nav-container ">
        <a class="navbar-brand" href="index.php">
          <span>
            Auchan - Commande de Lingots d'Or
          </span>
        </a>
        <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
          <span class=""></span>
        </button>

        <div class="collapse navbar-collapse" id="navbarSupportedContent">
          <ul class="navbar-nav  ">
            <li class="nav-item active">
              <a class="nav-link" href="index.php">Home <span class="sr-only"></span></a>
            </li>
        </div>
      </nav>
    </header>
      <section class="slider_section">
        <div class="slider_container">
          <div id="carouselExampleIndicators" class="carousel slide" data-ride="carousel">
            <div class="carousel-inner">
              <div class="carousel-item active">
                <div class="container-fluid">
                  <div class="row">
                    <div class="col-md-7">
                      <div class="detail-box">
                        <h1>
                          Bienvenue dans notre Service de Commande de Lingots d'Or
                        </h1>
                        <a href="">
                          Nous contacter
                        </a>
                      </div>
                    </div>
                    <div class="col-md-5 ">
                      <div class="img-box">
                        <img src="" alt="" />
                      </div>
                    </div>
                  </div>
                </div>
              </div>            
            </div>
          </div>
        </div>
      </section>
    </div>
    <!-- Produits section -->
    <section class="shop_section layout_padding">
      <div class="container">
          <div class="heading_container heading_center">
              <h2>
                  Nos Produits
              </h2>
          </div>
          <div class="row">
              <!-- Product 2 -->
              <div class="col-sm-6 col-md-4 col-lg-3">
                  <div class="box">
                    <h6>
                      Lingotin d’or 5g
                    </h6>
                      <a href="javascript:void(0);" onclick="openPopup('Lingotin d’or 5g', 'images/Auchan.png', 5)">
                          <div class="img-box">
                              <img src="images/Auchan.png" alt="Lingotin d’or 5g">
                          </div>
                          <div class="detail-box">
                              <h6>
                                  <span>
                                      Demander un prix
                                  </span>
                              </h6>
                          </div>
                      </a>
                  </div>
              </div>

              <!-- Product 3 -->
              <div class="col-sm-6 col-md-4 col-lg-3">
                  <div class="box">
                    <h6>
                      Lingotin d’or 10g
                    </h6>
                      <a href="javascript:void(0);" onclick="openPopup('Lingotin d’or 10g', 'images/Auchan.png', 10)">
                          <div class="img-box">
                              <img src="images/Auchan.png" alt="Lingotin d’or 10g">
                          </div>
                          <div class="detail-box">
                              <h6>
                                  <span>
                                      Demander un prix
                                  </span>
                              </h6>
                          </div>
                      </a>
                  </div>
              </div>

              <!-- Product 4 -->
              <div class="col-sm-6 col-md-4 col-lg-3">
                <div class="box">
                  <h6>
                    Lingotin d’or 20g
                  </h6>
                    <a href="javascript:void(0);" onclick="openPopup('Lingotin d’or 20g', 'images/Auchan.png')">
                        <div class="img-box">
                            <img src="images/Auchan.png" alt="Lingotin d’or 20g">
                        </div>
                        <div class="detail-box">
                            <h6>
                                <span>
                                    Demander un prix
                                </span>
                            </h6>
                        </div>
                    </a>
                </div>
            </div>

            
              <!-- Product 5 -->
              <div class="col-sm-6 col-md-4 col-lg-3">
                <div class="box">
                  <h6>
                    Lingotin d’or 31.1g
                  </h6>
                    <a href="javascript:void(0);" onclick="openPopup('Lingotin d’or 31.1g', 'images/Auchan.png')">
                        <div class="img-box">
                            <img src="images/Auchan.png" alt="Lingotin d’or 31.1g">
                        </div>
                        <div class="detail-box">
                            <h6>
                                <span>
                                    Demander un prix
                                </span>
                            </h6>
                        </div>
                    </a>
                </div>
            </div>


              <!-- Product 6 -->
              <div class="col-sm-6 col-md-4 col-lg-3">
                <div class="box">
                    <a href="javascript:void(0);" onclick="openPopup('Lingotin d’or 50g', 'images/Auchan.png')">
                      <h6>
                        Lingotin d’or 50g
                      </h6>
                        <div class="img-box">
                            <img src="images/Auchan.png" alt="Lingotin d’or 50g">
                        </div>
                        <div class="detail-box">
                            <h6>
                                <span>
                                    Demander un prix
                                </span>
                            </h6>
                        </div>
                    </a>
                </div>
            </div>

              <!-- Product 7 -->
              <div class="col-sm-6 col-md-4 col-lg-3">
                <div class="box">
                  <h6>
                    Lingotin d’or 100g
                  </h6>
                    <a href="javascript:void(0);" onclick="openPopup('Lingotin d’or 100g', 'images/Auchan.png')">
                        <div class="img-box">
                            <img src="images/Auchan.png" alt="Lingotin d’or 100g">
                        </div>
                        <div class="detail-box">
                            <h6>
                                <span>
                                    Demander un prix
                                </span>
                            </h6>
                        </div>
                    </a>
                </div>
            </div>
          </div>
      </div>
  </section>

    <!-- footer section -->
    <footer class=" footer_section">
      <div class="container">
        <p>
          &copy; <span id="displayYear"></span> Tous droits réservés par Mysaamp
        </p>
      </div>
    </footer>

    <!-- Popup -->
    <div class="popup_container" id="popup_container">
      <div class="popup">
        <span class="close" onclick="closePopup()">&times;</span>
        <h2 id="popupProductName">Demande de prix</h2>
        <div class="popup_content">
          <p id="popupWeight"></p>
          <label for="quantity">Veuillez saisir la quantité :</label>
          <input type="number" id="quantity" name="quantity" min="1" value="1">
          <button onclick="submitRequest()">Soumettre</button>
        </div>
      </div>
    </div>

    <!-- Deuxième Popup -->
    <div class="second_popup_container" id="second_popup_container">
      <div class="second_popup">
        <p id="popupTaux"></p>
        <p id="popupPoids"></p>
        <h4 id="popupPriceU">Prix Unitaire</h4>
        <h3 id="popupPriceT">Prix Total</h3>
        <p id="popupQuantity"></p>
        <p>Vous avez 30 secondes pour valider l'opération...</p>
        <div class="progress-bar-container">
          <div id="progress-bar" class="progress-bar"></div>
        </div>
        <br><br>
        <div class="button_container">
          <button onclick="validateRequest()">Valider</button>
          <button onclick="cancelRequest()">Annuler</button>
        </div>
      </div>
    </div>




    
  <script>
    function openPopup(productName, productImage, poids) {
      document.getElementById('quantity').value = 1;
      document.getElementById('popupProductName').innerText = productName;
      document.getElementById('popupWeight').innerText = 'Poids : ' + poids + 'g';
      document.getElementById('popup_container').style.display = 'block';
    }
  
    function closePopup() {
      document.getElementById('popup_container').style.display = 'none';
    }
  


    function submitRequest() {
    var quantity = document.getElementById('quantity').value;
    var poidsInput = document.getElementById('popupWeight').innerText;

    var apiUrl = 'includes/getPriceAPI.php';

    fetch(apiUrl, {
        method: 'GET',
        headers: {
            'Content-Type': 'application/json',
            'TokenID': 'eyJhbGciOiJIUzUxMiJ9.eyJFbnRpdHkiOiJTUE0iLCJpc3MiOiJPcm9zb2Z0IFNvbHV0aW9ucyBQdnQuIEx0ZC4iLCJDbGllbnRJZCI6IlMwMTQiLCJlbnYiOiJkZW1vIiwiZXhwIjoxNzM1Njg5NTk5fQ.agokh8jQVL6JKLI2otJVn-nrn85OR2U2toDR-t_7pT2EMEYt8va_1MxcjIja43XhH21Say5RRjVuZrdJUUtNUA',
        },
    })
    .then(response => response.json())
    .then(data => {
        if ('taux' in data) {
            var taux = data.taux;
            showSecondPopup(poidsInput, quantity, taux);
        } else {
            console.error('Erreur dans la réponse de l\'API :', data);
        }
    })
    .catch(error => {
        console.error('Erreur lors de la requête cURL :', error);
    });
}

    var duree = 30;
    var timePassed = 0;

    function updateProgressBar() {
            var progressBar = document.getElementById('progress-bar');
            timePassed += 1;
            var progressCourcent = (timePassed / duree) * 100;
            progressBar.style.width = progressCourcent + '%';
            if (timePassed >= duree) {
                clearInterval(progressInterval);
                closeSecondPopup();
            }
    }

    var progressInterval = setInterval(updateProgressBar, 1000); 
    
      function getFacon(poids) {
    if (poids == 5) {
      return 9.50;
    } else if (poids == 10) {
      return 12.00;
    } else if (poids == 20) {
      return 20.00;
    } else if (poids == 31.1) {
      return 21.00;
    } else if (poids == 50) {
      return 25.00;
    } else if (poids == 100) {
      return 30.00;
    } 
  }

    function showSecondPopup(poidsInput,quantity,taux) {
      var poidsString = poidsInput.split(' ')[2];
      var poids = parseFloat(poidsString.replace(/[^\d.]/g, ''));
      
      var Facon = getFacon(poids);
      var TauxEnG = (taux + 1) / 31.10348;
      var prixUnitaire = poids * ((taux + 1) / 31.10348) * 1.04 * 1.02 + Facon;
      var prixTotal = prixUnitaire * quantity;

      document.getElementById('popupPoids').innerText = 'Poids: ' + poids + ' G';
      document.getElementById('popupQuantity').innerText = 'Quantité: ' + quantity;
      document.getElementById('popupTaux').innerText = 'Taux : ' + TauxEnG;
      document.getElementById('popupPriceU').innerText = 'Prix Unitaire: ' + prixUnitaire.toFixed(2) + ' €';
      document.getElementById('popupPriceT').innerText = 'Prix Total: ' + prixTotal.toFixed(2) + ' €';
      document.getElementById('second_popup_container').style.display = 'block';
    }

    function closeSecondPopup() {
      document.getElementById('second_popup_container').style.display = 'none';
      document.getElementById('popup_container').style.display = 'block';
      window.location.href = 'index.php';
    }

    function validateRequest() {
      var poidsString = document.getElementById('popupPoids').innerText.split(':')[1].trim();
      var poids = parseFloat(poidsString.replace(/[^\d.]/g, ''));

      var url = 'recap.php' +
                '?poids=' + encodeURIComponent(poids) + 
                '&quantity=' + encodeURIComponent(document.getElementById('popupQuantity').innerText.split(':')[1].trim())
      window.location.href = url;
    }


    function cancelRequest() {
      closeSecondPopup();
      window.location.href = 'index.php';
    }

  </script>
  

</body>

</html>